<div class="change-container">
  <div class="change-card">

    <h3 class="title text-primary">Change Password</h3>

    <form #form="ngForm" (ngSubmit)="onChangePassword(form)" novalidate>

      <!-- Username Input -->
      <mat-form-field appearance="outline" class="w-100 mb-3">
        <mat-label>Username</mat-label>
        <input matInput
               placeholder="Enter Email / Mobile / Full Name"
               required
               name="emailOrPhoneOrName"
               [(ngModel)]="changeObj.emailOrPhoneOrName"
               #usernameCtrl="ngModel">
        <mat-error *ngIf="(form.submitted || usernameCtrl.touched) && usernameCtrl.invalid">
          Username is required.
        </mat-error>
      </mat-form-field>

      <!-- Old Password -->
      <mat-form-field appearance="outline" class="w-100 mb-3">
        <mat-label>Old Password</mat-label>
        <input matInput
               [type]="showOld ? 'text' : 'password'"
               placeholder="Enter Old Password"
               required
               name="oldPassword"
               [(ngModel)]="changeObj.oldPassword"
               #oldPassCtrl="ngModel">
        <button mat-icon-button
                matSuffix
                type="button"
                (click)="showOld = !showOld">
          <i class="bi" [ngClass]="showOld ? 'bi-eye-slash' : 'bi-eye'"></i>
        </button>
        <mat-error *ngIf="(form.submitted || oldPassCtrl.touched) && oldPassCtrl.invalid">
          Old password is required.
        </mat-error>
      </mat-form-field>

      <!-- New Password -->
      <mat-form-field appearance="outline" class="w-100 mb-3">
        <mat-label>New Password</mat-label>
        <input matInput
               [type]="showNew ? 'text' : 'password'"
               placeholder="Enter New Password"
               required
               pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*#?&]).{8,}$"
               name="newPassword"
               [(ngModel)]="changeObj.newPassword"
               #newPassCtrl="ngModel">
        <button mat-icon-button
                matSuffix
                type="button"
                (click)="showNew = !showNew">
          <i class="bi" [ngClass]="showNew ? 'bi-eye-slash' : 'bi-eye'"></i>
        </button>
        <mat-error *ngIf="(form.submitted || newPassCtrl.touched) && newPassCtrl.invalid">
          <span *ngIf="newPassCtrl.errors?.['required']">New password is required.</span>
          <span *ngIf="newPassCtrl.errors?.['pattern']">
            Password must be at least 8 characters, including uppercase, lowercase, number & special character.
          </span>
        </mat-error>
      </mat-form-field>

      <!-- Confirm Password -->
      <mat-form-field appearance="outline" class="w-100 mb-3">
        <mat-label>Confirm Password</mat-label>
        <input matInput
               [type]="showConfirm ? 'text' : 'password'"
               placeholder="Confirm New Password"
               required
               name="confirmPassword"
               [(ngModel)]="changeObj.confirmPassword"
               #confirmPassCtrl="ngModel">
        <button mat-icon-button
                matSuffix
                type="button"
                (click)="showConfirm = !showConfirm">
          <i class="bi" [ngClass]="showConfirm ? 'bi-eye-slash' : 'bi-eye'"></i>
        </button>
        <mat-error *ngIf="(form.submitted || confirmPassCtrl.touched) && confirmPassCtrl.invalid">
          Confirm password is required.
        </mat-error>
      </mat-form-field>

      <!-- Password Mismatch Error -->
      <div class="error-text mb-3"
           *ngIf="changeObj.newPassword && changeObj.confirmPassword &&
                  changeObj.newPassword !== changeObj.confirmPassword">
        Passwords do not match.
      </div>

      <!-- Submit Button -->
      <button mat-raised-button color="primary"
              type="submit"
              [disabled]="form.invalid || isLoading">
        <span *ngIf="!isLoading">Update Password</span>
        <span *ngIf="isLoading" class="loader"></span>
      </button>
 <div class="toast-container position-fixed top-0 end-0 p-3">
      <div #toastElement id="liveToast" class="toast custom-toast" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body">{{ toastMessage }}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast">
          </button>
        </div>
      </div>
    </div>
    </form>

  </div>
</div>
